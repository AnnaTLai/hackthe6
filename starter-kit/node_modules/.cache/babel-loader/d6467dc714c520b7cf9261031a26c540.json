{"ast":null,"code":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar _require = require('../../util/constants'),\n    E = _require.typeErrors,\n    trackPriority = _require.trackPriority;\n\nvar _require2 = require('@twilio/webrtc/lib/util'),\n    guessBrowser = _require2.guessBrowser;\n\nvar documentVisibilityMonitor = require('../../util/documentvisibilitymonitor.js');\n\nfunction mixinRemoteMediaTrack(AudioOrVideoTrack) {\n  /**\n   * A {@link RemoteMediaTrack} represents a {@link MediaTrack} published to a\n   * {@link Room} by a {@link RemoteParticipant}.\n   * @property {boolean} isEnabled - Whether the {@link RemoteMediaTrack} is enabled\n   * @property {boolean} isSwitchedOff - Whether the {@link RemoteMediaTrack} is switched off\n   * @property {Track.SID} sid - The SID assigned to the {@link RemoteMediaTrack}\n   * @property {?Track.Priority} priority - The subscribe priority of the {@link RemoteMediaTrack}\n   * @emits RemoteMediaTrack#disabled\n   * @emits RemoteMediaTrack#enabled\n   * @emits RemoteMediaTrack#switchedOff\n   * @emits RemoteMediaTrack#switchedOn\n   */\n  return function (_AudioOrVideoTrack) {\n    _inherits(RemoteMediaTrack, _AudioOrVideoTrack);\n    /**\n     * Construct a {@link RemoteMediaTrack}.\n     * @param {Track.SID} sid\n     * @param {MediaTrackReceiver} mediaTrackReceiver\n     * @param {boolean} isEnabled\n     * @param {function(?Track.Priority): void} setPriority - Set or clear the subscribe\n     *  {@link Track.Priority} of the {@link RemoteMediaTrack}\n     * @param {{log: Log, name: ?string}} options\n     */\n\n\n    function RemoteMediaTrack(sid, mediaTrackReceiver, isEnabled, setPriority, options) {\n      _classCallCheck(this, RemoteMediaTrack);\n\n      options = Object.assign({\n        // NOTE(mpatwardhan): WebKit bug: 212780 sometimes causes the audio/video elements to stay paused when safari\n        // regains foreground. To workaround it, when safari gains foreground - we will play any elements that were\n        // playing before safari lost foreground.\n        workaroundWebKitBug212780: guessBrowser() === 'safari' && (typeof document === 'undefined' ? 'undefined' : _typeof(document)) === 'object' && typeof document.addEventListener === 'function' && typeof document.visibilityState === 'string'\n      }, options);\n\n      var _this = _possibleConstructorReturn(this, (RemoteMediaTrack.__proto__ || Object.getPrototypeOf(RemoteMediaTrack)).call(this, mediaTrackReceiver, options));\n\n      Object.defineProperties(_this, {\n        _isEnabled: {\n          value: isEnabled,\n          writable: true\n        },\n        _isSwitchedOff: {\n          value: false,\n          writable: true\n        },\n        _priority: {\n          value: null,\n          writable: true\n        },\n        _setPriority: {\n          value: setPriority\n        },\n        isEnabled: {\n          enumerable: true,\n          get: function get() {\n            return this._isEnabled;\n          }\n        },\n        isSwitchedOff: {\n          enumerable: true,\n          get: function get() {\n            return this._isSwitchedOff;\n          }\n        },\n        priority: {\n          enumerable: true,\n          get: function get() {\n            return this._priority;\n          }\n        },\n        sid: {\n          enumerable: true,\n          value: sid\n        },\n        _workaroundWebKitBug212780: {\n          value: options.workaroundWebKitBug212780\n        },\n        _workaroundWebKitBug212780Cleanup: {\n          value: null,\n          writable: true\n        }\n      });\n      return _this;\n    }\n    /**\n     * Update the subscribe {@link Track.Priority} of the {@link RemoteMediaTrack}.\n     * @param {?Track.Priority} priority - the new subscribe {@link Track.Priority};\n     *   If <code>null</code>, then the subscribe {@link Track.Priority} is cleared, which\n     *   means the {@link Track.Priority} set by the publisher is now the effective priority.\n     * @returns {this}\n     * @throws {RangeError}\n     */\n\n\n    _createClass(RemoteMediaTrack, [{\n      key: 'setPriority',\n      value: function setPriority(priority) {\n        var priorityValues = [null].concat(_toConsumableArray(Object.values(trackPriority)));\n\n        if (!priorityValues.includes(priority)) {\n          // eslint-disable-next-line new-cap\n          throw E.INVALID_VALUE('priority', priorityValues);\n        }\n\n        if (this._priority !== priority) {\n          this._priority = priority;\n\n          this._setPriority(priority);\n        }\n\n        return this;\n      }\n      /**\n       * @private\n       * @param {boolean} isEnabled\n       */\n\n    }, {\n      key: '_setEnabled',\n      value: function _setEnabled(isEnabled) {\n        if (this._isEnabled !== isEnabled) {\n          this._isEnabled = isEnabled;\n          this.emit(this._isEnabled ? 'enabled' : 'disabled', this);\n        }\n      }\n      /**\n       * @private\n       * @param {boolean} isSwitchedOff\n       */\n\n    }, {\n      key: '_setSwitchedOff',\n      value: function _setSwitchedOff(isSwitchedOff) {\n        if (this._isSwitchedOff !== isSwitchedOff) {\n          this._isSwitchedOff = isSwitchedOff;\n          this.emit(isSwitchedOff ? 'switchedOff' : 'switchedOn', this);\n        }\n      }\n    }, {\n      key: 'attach',\n      value: function attach(el) {\n        var result = _get(RemoteMediaTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteMediaTrack.prototype), 'attach', this).call(this, el);\n\n        if (this.mediaStreamTrack.enabled !== true) {\n          // NOTE(mpatwardhan): we disable mediaStreamTrack when there\n          // are no attachments to it (see notes below). Now that there\n          // are attachments re-enable the track.\n          this.mediaStreamTrack.enabled = true;\n        }\n\n        if (this._workaroundWebKitBug212780) {\n          this._workaroundWebKitBug212780Cleanup = this._workaroundWebKitBug212780Cleanup || playIfPausedWhileInBackground(this);\n        }\n\n        return result;\n      }\n    }, {\n      key: 'detach',\n      value: function detach(el) {\n        var result = _get(RemoteMediaTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteMediaTrack.prototype), 'detach', this).call(this, el);\n\n        if (this._attachments.size === 0) {\n          // NOTE(mpatwardhan): chrome continues playing webrtc audio\n          // track even after audio element is removed from the DOM.\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=749928\n          // to workaround: here disable the track when\n          // there are no elements attached to it.\n          this.mediaStreamTrack.enabled = false;\n\n          if (this._workaroundWebKitBug212780Cleanup) {\n            // unhook visibility change\n            this._workaroundWebKitBug212780Cleanup();\n\n            this._workaroundWebKitBug212780Cleanup = null;\n          }\n        }\n\n        return result;\n      }\n    }]);\n\n    return RemoteMediaTrack;\n  }(AudioOrVideoTrack);\n}\n\nfunction playIfPausedWhileInBackground(remoteMediaTrack) {\n  var log = remoteMediaTrack._log,\n      kind = remoteMediaTrack.kind;\n\n  function onVisibilityChanged() {\n    remoteMediaTrack._attachments.forEach(function (el) {\n      var shim = remoteMediaTrack._elShims.get(el);\n\n      var isInadvertentlyPaused = el.paused && shim && !shim.pausedIntentionally();\n\n      if (isInadvertentlyPaused) {\n        log.info('Playing inadvertently paused <' + kind + '> element');\n        log.debug('Element:', el);\n        log.debug('RemoteMediaTrack:', remoteMediaTrack);\n        el.play().then(function () {\n          log.info('Successfully played inadvertently paused <' + kind + '> element');\n          log.debug('Element:', el);\n          log.debug('RemoteMediaTrack:', remoteMediaTrack);\n        }).catch(function (err) {\n          log.warn('Error while playing inadvertently paused <' + kind + '> element:', err, el, remoteMediaTrack);\n        });\n      }\n    });\n  } // NOTE(mpatwardhan): listen for document visibility callback on phase 2.\n  // this ensures that any LocalMediaTrack's restart (which listen on phase 1) gets executed\n  // first. This order is important because we `play` tracks in the callback, and\n  // play can fail on safari if audio is not being captured.\n\n\n  documentVisibilityMonitor.onVisible(2, onVisibilityChanged);\n  return function () {\n    documentVisibilityMonitor.offVisible(2, onVisibilityChanged);\n  };\n}\n/**\n * A {@link RemoteMediaTrack} was disabled.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   disabled\n * @event RemoteMediaTrack#disabled\n */\n\n/**\n * A {@link RemoteMediaTrack} was enabled.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   enabled\n * @event RemoteMediaTrack#enabled\n */\n\n/**\n * A {@link RemoteMediaTrack} was switched off.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   switched off\n * @event RemoteMediaTrack#switchedOff\n */\n\n/**\n * A {@link RemoteMediaTrack} was switched on.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   switched on\n * @event RemoteMediaTrack#switchedOn\n */\n\n\nmodule.exports = mixinRemoteMediaTrack;","map":{"version":3,"sources":["/Users/tony_niu/Visual Studio/Twilio/twilio-video-starter-kit/node_modules/twilio-video/es5/media/track/remotemediatrack.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","value","getter","call","_toConsumableArray","arr","Array","isArray","arr2","from","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","_require","require","E","typeErrors","trackPriority","_require2","guessBrowser","documentVisibilityMonitor","mixinRemoteMediaTrack","AudioOrVideoTrack","_AudioOrVideoTrack","RemoteMediaTrack","sid","mediaTrackReceiver","isEnabled","setPriority","options","assign","workaroundWebKitBug212780","document","addEventListener","visibilityState","_this","_isEnabled","_isSwitchedOff","_priority","_setPriority","isSwitchedOff","priority","_workaroundWebKitBug212780","_workaroundWebKitBug212780Cleanup","priorityValues","concat","values","includes","INVALID_VALUE","_setEnabled","emit","_setSwitchedOff","attach","el","result","mediaStreamTrack","enabled","playIfPausedWhileInBackground","detach","_attachments","size","remoteMediaTrack","log","_log","kind","onVisibilityChanged","forEach","shim","_elShims","isInadvertentlyPaused","paused","pausedIntentionally","info","debug","play","then","catch","err","warn","onVisible","offVisible","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,OAAO,GAAG,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA3D,GAAsE,UAAUC,GAAV,EAAe;AAAE,SAAO,OAAOA,GAAd;AAAoB,CAA3G,GAA8G,UAAUA,GAAV,EAAe;AAAE,SAAOA,GAAG,IAAI,OAAOF,MAAP,KAAkB,UAAzB,IAAuCE,GAAG,CAACC,WAAJ,KAAoBH,MAA3D,IAAqEE,GAAG,KAAKF,MAAM,CAACI,SAApF,GAAgG,QAAhG,GAA2G,OAAOF,GAAzH;AAA+H,CAA5Q;;AAEA,IAAIG,YAAY,GAAG,YAAY;AAAE,WAASC,gBAAT,CAA0BC,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AAAE,UAAIE,UAAU,GAAGH,KAAK,CAACC,CAAD,CAAtB;AAA2BE,MAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AAAwDD,MAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;AAAgC,UAAI,WAAWF,UAAf,EAA2BA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AAA4BC,MAAAA,MAAM,CAACC,cAAP,CAAsBT,MAAtB,EAA8BI,UAAU,CAACM,GAAzC,EAA8CN,UAA9C;AAA4D;AAAE;;AAAC,SAAO,UAAUO,WAAV,EAAuBC,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,QAAID,UAAJ,EAAgBb,gBAAgB,CAACY,WAAW,CAACd,SAAb,EAAwBe,UAAxB,CAAhB;AAAqD,QAAIC,WAAJ,EAAiBd,gBAAgB,CAACY,WAAD,EAAcE,WAAd,CAAhB;AAA4C,WAAOF,WAAP;AAAqB,GAAhN;AAAmN,CAA9hB,EAAnB;;AAEA,IAAIG,IAAI,GAAG,SAASC,GAAT,CAAaC,MAAb,EAAqBC,QAArB,EAA+BC,QAA/B,EAAyC;AAAE,MAAIF,MAAM,KAAK,IAAf,EAAqBA,MAAM,GAAGG,QAAQ,CAACtB,SAAlB;AAA6B,MAAIuB,IAAI,GAAGZ,MAAM,CAACa,wBAAP,CAAgCL,MAAhC,EAAwCC,QAAxC,CAAX;;AAA8D,MAAIG,IAAI,KAAKE,SAAb,EAAwB;AAAE,QAAIC,MAAM,GAAGf,MAAM,CAACgB,cAAP,CAAsBR,MAAtB,CAAb;;AAA4C,QAAIO,MAAM,KAAK,IAAf,EAAqB;AAAE,aAAOD,SAAP;AAAmB,KAA1C,MAAgD;AAAE,aAAOP,GAAG,CAACQ,MAAD,EAASN,QAAT,EAAmBC,QAAnB,CAAV;AAAyC;AAAE,GAAnK,MAAyK,IAAI,WAAWE,IAAf,EAAqB;AAAE,WAAOA,IAAI,CAACK,KAAZ;AAAoB,GAA3C,MAAiD;AAAE,QAAIC,MAAM,GAAGN,IAAI,CAACL,GAAlB;;AAAuB,QAAIW,MAAM,KAAKJ,SAAf,EAA0B;AAAE,aAAOA,SAAP;AAAmB;;AAAC,WAAOI,MAAM,CAACC,IAAP,CAAYT,QAAZ,CAAP;AAA+B;AAAE,CAA1e;;AAEA,SAASU,kBAAT,CAA4BC,GAA5B,EAAiC;AAAE,MAAIC,KAAK,CAACC,OAAN,CAAcF,GAAd,CAAJ,EAAwB;AAAE,SAAK,IAAI3B,CAAC,GAAG,CAAR,EAAW8B,IAAI,GAAGF,KAAK,CAACD,GAAG,CAAC1B,MAAL,CAA5B,EAA0CD,CAAC,GAAG2B,GAAG,CAAC1B,MAAlD,EAA0DD,CAAC,EAA3D,EAA+D;AAAE8B,MAAAA,IAAI,CAAC9B,CAAD,CAAJ,GAAU2B,GAAG,CAAC3B,CAAD,CAAb;AAAmB;;AAAC,WAAO8B,IAAP;AAAc,GAA7H,MAAmI;AAAE,WAAOF,KAAK,CAACG,IAAN,CAAWJ,GAAX,CAAP;AAAyB;AAAE;;AAEnM,SAASK,eAAT,CAAyBC,QAAzB,EAAmCxB,WAAnC,EAAgD;AAAE,MAAI,EAAEwB,QAAQ,YAAYxB,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIyB,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,0BAAT,CAAoCC,IAApC,EAA0CX,IAA1C,EAAgD;AAAE,MAAI,CAACW,IAAL,EAAW;AAAE,UAAM,IAAIC,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF;;AAAC,SAAOZ,IAAI,KAAK,OAAOA,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,IAAP,KAAgB,UAAjD,CAAJ,GAAmEA,IAAnE,GAA0EW,IAAjF;AAAwF;;AAEhP,SAASE,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AAAE,UAAM,IAAIN,SAAJ,CAAc,6DAA6D,OAAOM,UAAlF,CAAN;AAAsG;;AAACD,EAAAA,QAAQ,CAAC5C,SAAT,GAAqBW,MAAM,CAACmC,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAAC7C,SAAvC,EAAkD;AAAED,IAAAA,WAAW,EAAE;AAAE6B,MAAAA,KAAK,EAAEgB,QAAT;AAAmBpC,MAAAA,UAAU,EAAE,KAA/B;AAAsCE,MAAAA,QAAQ,EAAE,IAAhD;AAAsDD,MAAAA,YAAY,EAAE;AAApE;AAAf,GAAlD,CAArB;AAAqK,MAAIoC,UAAJ,EAAgBlC,MAAM,CAACoC,cAAP,GAAwBpC,MAAM,CAACoC,cAAP,CAAsBH,QAAtB,EAAgCC,UAAhC,CAAxB,GAAsED,QAAQ,CAACI,SAAT,GAAqBH,UAA3F;AAAwG;;AAE9e,IAAII,QAAQ,GAAGC,OAAO,CAAC,sBAAD,CAAtB;AAAA,IACIC,CAAC,GAAGF,QAAQ,CAACG,UADjB;AAAA,IAEIC,aAAa,GAAGJ,QAAQ,CAACI,aAF7B;;AAIA,IAAIC,SAAS,GAAGJ,OAAO,CAAC,yBAAD,CAAvB;AAAA,IACIK,YAAY,GAAGD,SAAS,CAACC,YAD7B;;AAGA,IAAIC,yBAAyB,GAAGN,OAAO,CAAC,yCAAD,CAAvC;;AAEA,SAASO,qBAAT,CAA+BC,iBAA/B,EAAkD;AAChD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACE,SAAO,UAAUC,kBAAV,EAA8B;AACnChB,IAAAA,SAAS,CAACiB,gBAAD,EAAmBD,kBAAnB,CAAT;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACI,aAASC,gBAAT,CAA0BC,GAA1B,EAA+BC,kBAA/B,EAAmDC,SAAnD,EAA8DC,WAA9D,EAA2EC,OAA3E,EAAoF;AAClF5B,MAAAA,eAAe,CAAC,IAAD,EAAOuB,gBAAP,CAAf;;AAEAK,MAAAA,OAAO,GAAGtD,MAAM,CAACuD,MAAP,CAAc;AACtB;AACA;AACA;AACAC,QAAAA,yBAAyB,EAAEZ,YAAY,OAAO,QAAnB,IAA+B,CAAC,OAAOa,QAAP,KAAoB,WAApB,GAAkC,WAAlC,GAAgDzE,OAAO,CAACyE,QAAD,CAAxD,MAAwE,QAAvG,IAAmH,OAAOA,QAAQ,CAACC,gBAAhB,KAAqC,UAAxJ,IAAsK,OAAOD,QAAQ,CAACE,eAAhB,KAAoC;AAJ/M,OAAd,EAKPL,OALO,CAAV;;AAOA,UAAIM,KAAK,GAAG/B,0BAA0B,CAAC,IAAD,EAAO,CAACoB,gBAAgB,CAACZ,SAAjB,IAA8BrC,MAAM,CAACgB,cAAP,CAAsBiC,gBAAtB,CAA/B,EAAwE9B,IAAxE,CAA6E,IAA7E,EAAmFgC,kBAAnF,EAAuGG,OAAvG,CAAP,CAAtC;;AAEAtD,MAAAA,MAAM,CAACT,gBAAP,CAAwBqE,KAAxB,EAA+B;AAC7BC,QAAAA,UAAU,EAAE;AACV5C,UAAAA,KAAK,EAAEmC,SADG;AAEVrD,UAAAA,QAAQ,EAAE;AAFA,SADiB;AAK7B+D,QAAAA,cAAc,EAAE;AACd7C,UAAAA,KAAK,EAAE,KADO;AAEdlB,UAAAA,QAAQ,EAAE;AAFI,SALa;AAS7BgE,QAAAA,SAAS,EAAE;AACT9C,UAAAA,KAAK,EAAE,IADE;AAETlB,UAAAA,QAAQ,EAAE;AAFD,SATkB;AAa7BiE,QAAAA,YAAY,EAAE;AACZ/C,UAAAA,KAAK,EAAEoC;AADK,SAbe;AAgB7BD,QAAAA,SAAS,EAAE;AACTvD,UAAAA,UAAU,EAAE,IADH;AAETU,UAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,mBAAO,KAAKsD,UAAZ;AACD;AAJQ,SAhBkB;AAsB7BI,QAAAA,aAAa,EAAE;AACbpE,UAAAA,UAAU,EAAE,IADC;AAEbU,UAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,mBAAO,KAAKuD,cAAZ;AACD;AAJY,SAtBc;AA4B7BI,QAAAA,QAAQ,EAAE;AACRrE,UAAAA,UAAU,EAAE,IADJ;AAERU,UAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,mBAAO,KAAKwD,SAAZ;AACD;AAJO,SA5BmB;AAkC7Bb,QAAAA,GAAG,EAAE;AACHrD,UAAAA,UAAU,EAAE,IADT;AAEHoB,UAAAA,KAAK,EAAEiC;AAFJ,SAlCwB;AAsC7BiB,QAAAA,0BAA0B,EAAE;AAC1BlD,UAAAA,KAAK,EAAEqC,OAAO,CAACE;AADW,SAtCC;AAyC7BY,QAAAA,iCAAiC,EAAE;AACjCnD,UAAAA,KAAK,EAAE,IAD0B;AAEjClB,UAAAA,QAAQ,EAAE;AAFuB;AAzCN,OAA/B;AA8CA,aAAO6D,KAAP;AACD;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGItE,IAAAA,YAAY,CAAC2D,gBAAD,EAAmB,CAAC;AAC9B/C,MAAAA,GAAG,EAAE,aADyB;AAE9Be,MAAAA,KAAK,EAAE,SAASoC,WAAT,CAAqBa,QAArB,EAA+B;AACpC,YAAIG,cAAc,GAAG,CAAC,IAAD,EAAOC,MAAP,CAAclD,kBAAkB,CAACpB,MAAM,CAACuE,MAAP,CAAc7B,aAAd,CAAD,CAAhC,CAArB;;AACA,YAAI,CAAC2B,cAAc,CAACG,QAAf,CAAwBN,QAAxB,CAAL,EAAwC;AACtC;AACA,gBAAM1B,CAAC,CAACiC,aAAF,CAAgB,UAAhB,EAA4BJ,cAA5B,CAAN;AACD;;AACD,YAAI,KAAKN,SAAL,KAAmBG,QAAvB,EAAiC;AAC/B,eAAKH,SAAL,GAAiBG,QAAjB;;AACA,eAAKF,YAAL,CAAkBE,QAAlB;AACD;;AACD,eAAO,IAAP;AACD;AAED;AACN;AACA;AACA;;AAlBoC,KAAD,EAoB5B;AACDhE,MAAAA,GAAG,EAAE,aADJ;AAEDe,MAAAA,KAAK,EAAE,SAASyD,WAAT,CAAqBtB,SAArB,EAAgC;AACrC,YAAI,KAAKS,UAAL,KAAoBT,SAAxB,EAAmC;AACjC,eAAKS,UAAL,GAAkBT,SAAlB;AACA,eAAKuB,IAAL,CAAU,KAAKd,UAAL,GAAkB,SAAlB,GAA8B,UAAxC,EAAoD,IAApD;AACD;AACF;AAED;AACN;AACA;AACA;;AAZO,KApB4B,EAkC5B;AACD3D,MAAAA,GAAG,EAAE,iBADJ;AAEDe,MAAAA,KAAK,EAAE,SAAS2D,eAAT,CAAyBX,aAAzB,EAAwC;AAC7C,YAAI,KAAKH,cAAL,KAAwBG,aAA5B,EAA2C;AACzC,eAAKH,cAAL,GAAsBG,aAAtB;AACA,eAAKU,IAAL,CAAUV,aAAa,GAAG,aAAH,GAAmB,YAA1C,EAAwD,IAAxD;AACD;AACF;AAPA,KAlC4B,EA0C5B;AACD/D,MAAAA,GAAG,EAAE,QADJ;AAEDe,MAAAA,KAAK,EAAE,SAAS4D,MAAT,CAAgBC,EAAhB,EAAoB;AACzB,YAAIC,MAAM,GAAGzE,IAAI,CAAC2C,gBAAgB,CAAC5D,SAAjB,CAA2BgD,SAA3B,IAAwCrC,MAAM,CAACgB,cAAP,CAAsBiC,gBAAgB,CAAC5D,SAAvC,CAAzC,EAA4F,QAA5F,EAAsG,IAAtG,CAAJ,CAAgH8B,IAAhH,CAAqH,IAArH,EAA2H2D,EAA3H,CAAb;;AACA,YAAI,KAAKE,gBAAL,CAAsBC,OAAtB,KAAkC,IAAtC,EAA4C;AAC1C;AACA;AACA;AACA,eAAKD,gBAAL,CAAsBC,OAAtB,GAAgC,IAAhC;AACD;;AACD,YAAI,KAAKd,0BAAT,EAAqC;AACnC,eAAKC,iCAAL,GAAyC,KAAKA,iCAAL,IAA0Cc,6BAA6B,CAAC,IAAD,CAAhH;AACD;;AAED,eAAOH,MAAP;AACD;AAfA,KA1C4B,EA0D5B;AACD7E,MAAAA,GAAG,EAAE,QADJ;AAEDe,MAAAA,KAAK,EAAE,SAASkE,MAAT,CAAgBL,EAAhB,EAAoB;AACzB,YAAIC,MAAM,GAAGzE,IAAI,CAAC2C,gBAAgB,CAAC5D,SAAjB,CAA2BgD,SAA3B,IAAwCrC,MAAM,CAACgB,cAAP,CAAsBiC,gBAAgB,CAAC5D,SAAvC,CAAzC,EAA4F,QAA5F,EAAsG,IAAtG,CAAJ,CAAgH8B,IAAhH,CAAqH,IAArH,EAA2H2D,EAA3H,CAAb;;AACA,YAAI,KAAKM,YAAL,CAAkBC,IAAlB,KAA2B,CAA/B,EAAkC;AAChC;AACA;AACA;AACA;AACA;AACA,eAAKL,gBAAL,CAAsBC,OAAtB,GAAgC,KAAhC;;AAEA,cAAI,KAAKb,iCAAT,EAA4C;AAC1C;AACA,iBAAKA,iCAAL;;AACA,iBAAKA,iCAAL,GAAyC,IAAzC;AACD;AACF;;AACD,eAAOW,MAAP;AACD;AAnBA,KA1D4B,CAAnB,CAAZ;;AAgFA,WAAO9B,gBAAP;AACD,GApKM,CAoKLF,iBApKK,CAAP;AAqKD;;AAED,SAASmC,6BAAT,CAAuCI,gBAAvC,EAAyD;AACvD,MAAIC,GAAG,GAAGD,gBAAgB,CAACE,IAA3B;AAAA,MACIC,IAAI,GAAGH,gBAAgB,CAACG,IAD5B;;AAIA,WAASC,mBAAT,GAA+B;AAC7BJ,IAAAA,gBAAgB,CAACF,YAAjB,CAA8BO,OAA9B,CAAsC,UAAUb,EAAV,EAAc;AAClD,UAAIc,IAAI,GAAGN,gBAAgB,CAACO,QAAjB,CAA0BtF,GAA1B,CAA8BuE,EAA9B,CAAX;;AACA,UAAIgB,qBAAqB,GAAGhB,EAAE,CAACiB,MAAH,IAAaH,IAAb,IAAqB,CAACA,IAAI,CAACI,mBAAL,EAAlD;;AACA,UAAIF,qBAAJ,EAA2B;AACzBP,QAAAA,GAAG,CAACU,IAAJ,CAAS,mCAAmCR,IAAnC,GAA0C,WAAnD;AACAF,QAAAA,GAAG,CAACW,KAAJ,CAAU,UAAV,EAAsBpB,EAAtB;AACAS,QAAAA,GAAG,CAACW,KAAJ,CAAU,mBAAV,EAA+BZ,gBAA/B;AACAR,QAAAA,EAAE,CAACqB,IAAH,GAAUC,IAAV,CAAe,YAAY;AACzBb,UAAAA,GAAG,CAACU,IAAJ,CAAS,+CAA+CR,IAA/C,GAAsD,WAA/D;AACAF,UAAAA,GAAG,CAACW,KAAJ,CAAU,UAAV,EAAsBpB,EAAtB;AACAS,UAAAA,GAAG,CAACW,KAAJ,CAAU,mBAAV,EAA+BZ,gBAA/B;AACD,SAJD,EAIGe,KAJH,CAIS,UAAUC,GAAV,EAAe;AACtBf,UAAAA,GAAG,CAACgB,IAAJ,CAAS,+CAA+Cd,IAA/C,GAAsD,YAA/D,EAA6Ea,GAA7E,EAAkFxB,EAAlF,EAAsFQ,gBAAtF;AACD,SAND;AAOD;AACF,KAfD;AAgBD,GAtBsD,CAwBvD;AACA;AACA;AACA;;;AACAzC,EAAAA,yBAAyB,CAAC2D,SAA1B,CAAoC,CAApC,EAAuCd,mBAAvC;AACA,SAAO,YAAY;AACjB7C,IAAAA,yBAAyB,CAAC4D,UAA1B,CAAqC,CAArC,EAAwCf,mBAAxC;AACD,GAFD;AAGD;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAEAgB,MAAM,CAACC,OAAP,GAAiB7D,qBAAjB","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar _require = require('../../util/constants'),\n    E = _require.typeErrors,\n    trackPriority = _require.trackPriority;\n\nvar _require2 = require('@twilio/webrtc/lib/util'),\n    guessBrowser = _require2.guessBrowser;\n\nvar documentVisibilityMonitor = require('../../util/documentvisibilitymonitor.js');\n\nfunction mixinRemoteMediaTrack(AudioOrVideoTrack) {\n  /**\n   * A {@link RemoteMediaTrack} represents a {@link MediaTrack} published to a\n   * {@link Room} by a {@link RemoteParticipant}.\n   * @property {boolean} isEnabled - Whether the {@link RemoteMediaTrack} is enabled\n   * @property {boolean} isSwitchedOff - Whether the {@link RemoteMediaTrack} is switched off\n   * @property {Track.SID} sid - The SID assigned to the {@link RemoteMediaTrack}\n   * @property {?Track.Priority} priority - The subscribe priority of the {@link RemoteMediaTrack}\n   * @emits RemoteMediaTrack#disabled\n   * @emits RemoteMediaTrack#enabled\n   * @emits RemoteMediaTrack#switchedOff\n   * @emits RemoteMediaTrack#switchedOn\n   */\n  return function (_AudioOrVideoTrack) {\n    _inherits(RemoteMediaTrack, _AudioOrVideoTrack);\n\n    /**\n     * Construct a {@link RemoteMediaTrack}.\n     * @param {Track.SID} sid\n     * @param {MediaTrackReceiver} mediaTrackReceiver\n     * @param {boolean} isEnabled\n     * @param {function(?Track.Priority): void} setPriority - Set or clear the subscribe\n     *  {@link Track.Priority} of the {@link RemoteMediaTrack}\n     * @param {{log: Log, name: ?string}} options\n     */\n    function RemoteMediaTrack(sid, mediaTrackReceiver, isEnabled, setPriority, options) {\n      _classCallCheck(this, RemoteMediaTrack);\n\n      options = Object.assign({\n        // NOTE(mpatwardhan): WebKit bug: 212780 sometimes causes the audio/video elements to stay paused when safari\n        // regains foreground. To workaround it, when safari gains foreground - we will play any elements that were\n        // playing before safari lost foreground.\n        workaroundWebKitBug212780: guessBrowser() === 'safari' && (typeof document === 'undefined' ? 'undefined' : _typeof(document)) === 'object' && typeof document.addEventListener === 'function' && typeof document.visibilityState === 'string'\n      }, options);\n\n      var _this = _possibleConstructorReturn(this, (RemoteMediaTrack.__proto__ || Object.getPrototypeOf(RemoteMediaTrack)).call(this, mediaTrackReceiver, options));\n\n      Object.defineProperties(_this, {\n        _isEnabled: {\n          value: isEnabled,\n          writable: true\n        },\n        _isSwitchedOff: {\n          value: false,\n          writable: true\n        },\n        _priority: {\n          value: null,\n          writable: true\n        },\n        _setPriority: {\n          value: setPriority\n        },\n        isEnabled: {\n          enumerable: true,\n          get: function get() {\n            return this._isEnabled;\n          }\n        },\n        isSwitchedOff: {\n          enumerable: true,\n          get: function get() {\n            return this._isSwitchedOff;\n          }\n        },\n        priority: {\n          enumerable: true,\n          get: function get() {\n            return this._priority;\n          }\n        },\n        sid: {\n          enumerable: true,\n          value: sid\n        },\n        _workaroundWebKitBug212780: {\n          value: options.workaroundWebKitBug212780\n        },\n        _workaroundWebKitBug212780Cleanup: {\n          value: null,\n          writable: true\n        }\n      });\n      return _this;\n    }\n\n    /**\n     * Update the subscribe {@link Track.Priority} of the {@link RemoteMediaTrack}.\n     * @param {?Track.Priority} priority - the new subscribe {@link Track.Priority};\n     *   If <code>null</code>, then the subscribe {@link Track.Priority} is cleared, which\n     *   means the {@link Track.Priority} set by the publisher is now the effective priority.\n     * @returns {this}\n     * @throws {RangeError}\n     */\n\n\n    _createClass(RemoteMediaTrack, [{\n      key: 'setPriority',\n      value: function setPriority(priority) {\n        var priorityValues = [null].concat(_toConsumableArray(Object.values(trackPriority)));\n        if (!priorityValues.includes(priority)) {\n          // eslint-disable-next-line new-cap\n          throw E.INVALID_VALUE('priority', priorityValues);\n        }\n        if (this._priority !== priority) {\n          this._priority = priority;\n          this._setPriority(priority);\n        }\n        return this;\n      }\n\n      /**\n       * @private\n       * @param {boolean} isEnabled\n       */\n\n    }, {\n      key: '_setEnabled',\n      value: function _setEnabled(isEnabled) {\n        if (this._isEnabled !== isEnabled) {\n          this._isEnabled = isEnabled;\n          this.emit(this._isEnabled ? 'enabled' : 'disabled', this);\n        }\n      }\n\n      /**\n       * @private\n       * @param {boolean} isSwitchedOff\n       */\n\n    }, {\n      key: '_setSwitchedOff',\n      value: function _setSwitchedOff(isSwitchedOff) {\n        if (this._isSwitchedOff !== isSwitchedOff) {\n          this._isSwitchedOff = isSwitchedOff;\n          this.emit(isSwitchedOff ? 'switchedOff' : 'switchedOn', this);\n        }\n      }\n    }, {\n      key: 'attach',\n      value: function attach(el) {\n        var result = _get(RemoteMediaTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteMediaTrack.prototype), 'attach', this).call(this, el);\n        if (this.mediaStreamTrack.enabled !== true) {\n          // NOTE(mpatwardhan): we disable mediaStreamTrack when there\n          // are no attachments to it (see notes below). Now that there\n          // are attachments re-enable the track.\n          this.mediaStreamTrack.enabled = true;\n        }\n        if (this._workaroundWebKitBug212780) {\n          this._workaroundWebKitBug212780Cleanup = this._workaroundWebKitBug212780Cleanup || playIfPausedWhileInBackground(this);\n        }\n\n        return result;\n      }\n    }, {\n      key: 'detach',\n      value: function detach(el) {\n        var result = _get(RemoteMediaTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteMediaTrack.prototype), 'detach', this).call(this, el);\n        if (this._attachments.size === 0) {\n          // NOTE(mpatwardhan): chrome continues playing webrtc audio\n          // track even after audio element is removed from the DOM.\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=749928\n          // to workaround: here disable the track when\n          // there are no elements attached to it.\n          this.mediaStreamTrack.enabled = false;\n\n          if (this._workaroundWebKitBug212780Cleanup) {\n            // unhook visibility change\n            this._workaroundWebKitBug212780Cleanup();\n            this._workaroundWebKitBug212780Cleanup = null;\n          }\n        }\n        return result;\n      }\n    }]);\n\n    return RemoteMediaTrack;\n  }(AudioOrVideoTrack);\n}\n\nfunction playIfPausedWhileInBackground(remoteMediaTrack) {\n  var log = remoteMediaTrack._log,\n      kind = remoteMediaTrack.kind;\n\n\n  function onVisibilityChanged() {\n    remoteMediaTrack._attachments.forEach(function (el) {\n      var shim = remoteMediaTrack._elShims.get(el);\n      var isInadvertentlyPaused = el.paused && shim && !shim.pausedIntentionally();\n      if (isInadvertentlyPaused) {\n        log.info('Playing inadvertently paused <' + kind + '> element');\n        log.debug('Element:', el);\n        log.debug('RemoteMediaTrack:', remoteMediaTrack);\n        el.play().then(function () {\n          log.info('Successfully played inadvertently paused <' + kind + '> element');\n          log.debug('Element:', el);\n          log.debug('RemoteMediaTrack:', remoteMediaTrack);\n        }).catch(function (err) {\n          log.warn('Error while playing inadvertently paused <' + kind + '> element:', err, el, remoteMediaTrack);\n        });\n      }\n    });\n  }\n\n  // NOTE(mpatwardhan): listen for document visibility callback on phase 2.\n  // this ensures that any LocalMediaTrack's restart (which listen on phase 1) gets executed\n  // first. This order is important because we `play` tracks in the callback, and\n  // play can fail on safari if audio is not being captured.\n  documentVisibilityMonitor.onVisible(2, onVisibilityChanged);\n  return function () {\n    documentVisibilityMonitor.offVisible(2, onVisibilityChanged);\n  };\n}\n\n/**\n * A {@link RemoteMediaTrack} was disabled.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   disabled\n * @event RemoteMediaTrack#disabled\n */\n\n/**\n * A {@link RemoteMediaTrack} was enabled.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   enabled\n * @event RemoteMediaTrack#enabled\n */\n\n/**\n * A {@link RemoteMediaTrack} was switched off.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   switched off\n * @event RemoteMediaTrack#switchedOff\n */\n\n/**\n * A {@link RemoteMediaTrack} was switched on.\n * @param {RemoteMediaTrack} track - The {@link RemoteMediaTrack} that was\n *   switched on\n * @event RemoteMediaTrack#switchedOn\n */\n\nmodule.exports = mixinRemoteMediaTrack;"]},"metadata":{},"sourceType":"script"}