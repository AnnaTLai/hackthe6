{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar jwt = require('jsonwebtoken');\n\nvar util = require('util');\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.workspaceSid - The workspace unique ID\n * @param {string} options.workerSid - The worker unique ID\n * @param {string} options.role - The role of the grant\n */\n\n\nfunction TaskRouterGrant(options) {\n  options = options || {};\n  this.workspaceSid = options.workspaceSid;\n  this.workerSid = options.workerSid;\n  this.role = options.role;\n}\n\n_c = TaskRouterGrant;\n\n_.extend(TaskRouterGrant.prototype, {\n  key: 'task_router',\n  toPayload: function () {\n    var grant = {};\n\n    if (this.workspaceSid) {\n      grant.workspace_sid = this.workspaceSid;\n    }\n\n    if (this.workerSid) {\n      grant.worker_sid = this.workerSid;\n    }\n\n    if (this.role) {\n      grant.role = this.role;\n    }\n\n    return grant;\n  }\n});\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.serviceSid - The service unique ID\n * @param {string} options.endpointId - The endpoint ID\n * @param {string} options.deploymentRoleSid - SID of the deployment role to be\n *                 assigned to the user\n * @param {string} options.pushCredentialSid - The Push Credentials SID\n */\n\n\nfunction ChatGrant(options) {\n  options = options || {};\n  this.serviceSid = options.serviceSid;\n  this.endpointId = options.endpointId;\n  this.deploymentRoleSid = options.deploymentRoleSid;\n  this.pushCredentialSid = options.pushCredentialSid;\n}\n\n_c2 = ChatGrant;\n\n_.extend(ChatGrant.prototype, {\n  key: 'chat',\n  toPayload: function () {\n    var grant = {};\n\n    if (this.serviceSid) {\n      grant.service_sid = this.serviceSid;\n    }\n\n    if (this.endpointId) {\n      grant.endpoint_id = this.endpointId;\n    }\n\n    if (this.deploymentRoleSid) {\n      grant.deployment_role_sid = this.deploymentRoleSid;\n    }\n\n    if (this.pushCredentialSid) {\n      grant.push_credential_sid = this.pushCredentialSid;\n    }\n\n    return grant;\n  }\n});\n/**\n * @deprecated - Use ChatGrant instead.\n *\n * @constructor\n * @param {object} options - ...\n * @param {string} options.serviceSid - The service unique ID\n * @param {string} options.endpointId - The endpoint ID\n * @param {string} options.deploymentRoleSid - SID of the deployment role to be\n *                 assigned to the user\n * @param {string} options.pushCredentialSid - The Push Credentials SID\n */\n\n\nfunction IpMessagingGrant(options) {\n  ChatGrant.call(this, options);\n}\n\n_c3 = IpMessagingGrant;\nIpMessagingGrant.prototype = _.create(ChatGrant.prototype, _.assign({\n  '_super': ChatGrant.prototype,\n  'constructor': ChatGrant\n}));\nIpMessagingGrant.prototype.key = 'ip_messaging';\n/**\n  * @deprecated - Use VideoGrant instead\n  *\n  * @constructor\n  * @param {object} options - ...\n  * @param {string} options.configurationProfileSid - The configuration\n  *                 profile unique ID\n  */\n\nfunction ConversationsGrant(options) {\n  options = options || {};\n  this.configurationProfileSid = options.configurationProfileSid;\n}\n\n_c4 = ConversationsGrant;\n\n_.extend(ConversationsGrant.prototype, {\n  key: 'rtc',\n  toPayload: function () {\n    var grant = {};\n\n    if (this.configurationProfileSid) {\n      grant.configuration_profile_sid = this.configurationProfileSid;\n    }\n\n    return grant;\n  }\n});\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.room - The Room name or Room sid.\n */\n\n\nfunction VideoGrant(options) {\n  options = options || {};\n  this.room = options.room;\n}\n\n_c5 = VideoGrant;\n\n_.extend(VideoGrant.prototype, {\n  key: 'video',\n  toPayload: function () {\n    var grant = {};\n\n    if (this.room) {\n      grant.room = this.room;\n    }\n\n    return grant;\n  }\n});\n/**\n * @constructor\n * @param {string} options.serviceSid - The service unique ID\n * @param {string} options.endpointId - The endpoint ID\n */\n\n\nfunction SyncGrant(options) {\n  options = options || {};\n  this.serviceSid = options.serviceSid;\n  this.endpointId = options.endpointId;\n}\n\n_c6 = SyncGrant;\n\n_.extend(SyncGrant.prototype, {\n  key: 'data_sync',\n  toPayload: function () {\n    var grant = {};\n\n    if (this.serviceSid) {\n      grant.service_sid = this.serviceSid;\n    }\n\n    if (this.endpointId) {\n      grant.endpoint_id = this.endpointId;\n    }\n\n    return grant;\n  }\n});\n/**\n * @constructor\n * @param {object} options - ...\n * @param {boolean} options.incomingAllow - Whether or not this endpoint is allowed to receive incoming calls as grants.identity\n * @param {string} options.outgoingApplicationSid - application sid to call when placing outgoing call\n * @param {object} options.outgoingApplicationParams - request params to pass to the application\n * @param {string} options.pushCredentialSid - Push Credential Sid to use when registering to receive incoming call notifications\n * @param {string} options.endpointId - Specify an endpoint identifier for this device, which will allow the developer\n *                 to direct calls to a specific endpoint when multiple devices are associated with a single identity\n */\n\n\nfunction VoiceGrant(options) {\n  options = options || {};\n  this.incomingAllow = options.incomingAllow;\n  this.outgoingApplicationSid = options.outgoingApplicationSid;\n  this.outgoingApplicationParams = options.outgoingApplicationParams;\n  this.pushCredentialSid = options.pushCredentialSid;\n  this.endpointId = options.endpointId;\n}\n\n_c7 = VoiceGrant;\n\n_.extend(VoiceGrant.prototype, {\n  key: 'voice',\n  toPayload: function () {\n    var grant = {};\n\n    if (this.incomingAllow === true) {\n      grant.incoming = {\n        allow: true\n      };\n    }\n\n    if (this.outgoingApplicationSid) {\n      grant.outgoing = {};\n      grant.outgoing.application_sid = this.outgoingApplicationSid;\n\n      if (this.outgoingApplicationParams) {\n        grant.outgoing.params = this.outgoingApplicationParams;\n      }\n    }\n\n    if (this.pushCredentialSid) {\n      grant.push_credential_sid = this.pushCredentialSid;\n    }\n\n    if (this.endpointId) {\n      grant.endpoint_id = this.endpointId;\n    }\n\n    return grant;\n  }\n});\n/**\n * @constructor\n * @param {string} accountSid - The account's unique ID to which access is scoped\n * @param {string} keySid - The signing key's unique ID\n * @param {string} secret - The secret to sign the token with\n * @param {object} options - ...\n * @param {number} [options.ttl=3600] - Time to live in seconds\n * @param {string} [options.identity] - The identity of the first person\n * @param {number} [options.nbf] - Time from epoch in seconds for not before value\n * @param {string} [options.region] - The region value associated with this account\n */\n\n\nfunction AccessToken(accountSid, keySid, secret, options) {\n  if (!accountSid) {\n    throw new Error('accountSid is required');\n  }\n\n  if (!keySid) {\n    throw new Error('keySid is required');\n  }\n\n  if (!secret) {\n    throw new Error('secret is required');\n  }\n\n  options = options || {};\n  this.accountSid = accountSid;\n  this.keySid = keySid;\n  this.secret = secret;\n  this.ttl = options.ttl || 3600;\n  this.identity = options.identity;\n  this.nbf = options.nbf;\n  this.region = options.region;\n  this.grants = [];\n} // Class level properties\n\n\n_c8 = AccessToken;\nAccessToken.IpMessagingGrant = util.deprecate(IpMessagingGrant, 'IpMessagingGrant is deprecated, use ChatGrant instead.');\nAccessToken.ChatGrant = ChatGrant;\nAccessToken.VoiceGrant = VoiceGrant;\nAccessToken.SyncGrant = SyncGrant;\nAccessToken.VideoGrant = VideoGrant;\nAccessToken.ConversationsGrant = util.deprecate(ConversationsGrant, 'ConversationsGrant is deprecated, use VideoGrant instead.');\nAccessToken.TaskRouterGrant = TaskRouterGrant;\nAccessToken.DEFAULT_ALGORITHM = 'HS256';\nAccessToken.ALGORITHMS = ['HS256', 'HS384', 'HS512'];\n\n_.extend(AccessToken.prototype, {\n  addGrant: function (grant) {\n    this.grants.push(grant);\n  },\n  toJwt: function (algorithm) {\n    algorithm = algorithm || AccessToken.DEFAULT_ALGORITHM;\n\n    if (!_.includes(AccessToken.ALGORITHMS, algorithm)) {\n      throw new Error('Algorithm not supported. Allowed values are ' + AccessToken.ALGORITHMS.join(', '));\n    }\n\n    var grants = {};\n\n    if (_.isInteger(this.identity) || _.isString(this.identity)) {\n      grants.identity = String(this.identity);\n    }\n\n    _.each(this.grants, function (grant) {\n      grants[grant.key] = grant.toPayload();\n    });\n\n    var now = Math.floor(Date.now() / 1000);\n    var payload = {\n      jti: this.keySid + '-' + now,\n      grants: grants\n    };\n\n    if (_.isNumber(this.nbf)) {\n      payload.nbf = this.nbf;\n    }\n\n    var header = {\n      cty: 'twilio-fpa;v=1',\n      typ: 'JWT'\n    };\n\n    if (this.region && _.isString(this.region)) {\n      header.twr = this.region;\n    }\n\n    return jwt.sign(payload, this.secret, {\n      header: header,\n      algorithm: algorithm,\n      issuer: this.keySid,\n      subject: this.accountSid,\n      expiresIn: this.ttl\n    });\n  }\n});\n\nmodule.exports = AccessToken;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8;\n\n$RefreshReg$(_c, \"TaskRouterGrant\");\n$RefreshReg$(_c2, \"ChatGrant\");\n$RefreshReg$(_c3, \"IpMessagingGrant\");\n$RefreshReg$(_c4, \"ConversationsGrant\");\n$RefreshReg$(_c5, \"VideoGrant\");\n$RefreshReg$(_c6, \"SyncGrant\");\n$RefreshReg$(_c7, \"VoiceGrant\");\n$RefreshReg$(_c8, \"AccessToken\");","map":{"version":3,"sources":["/Users/tony_niu/Visual Studio/Twilio/twilio-video-starter-kit/src/token-service/node_modules/twilio/lib/jwt/AccessToken.js"],"names":["_","require","jwt","util","TaskRouterGrant","options","workspaceSid","workerSid","role","extend","prototype","key","toPayload","grant","workspace_sid","worker_sid","ChatGrant","serviceSid","endpointId","deploymentRoleSid","pushCredentialSid","service_sid","endpoint_id","deployment_role_sid","push_credential_sid","IpMessagingGrant","call","create","assign","ConversationsGrant","configurationProfileSid","configuration_profile_sid","VideoGrant","room","SyncGrant","VoiceGrant","incomingAllow","outgoingApplicationSid","outgoingApplicationParams","incoming","allow","outgoing","application_sid","params","AccessToken","accountSid","keySid","secret","Error","ttl","identity","nbf","region","grants","deprecate","DEFAULT_ALGORITHM","ALGORITHMS","addGrant","push","toJwt","algorithm","includes","join","isInteger","isString","String","each","now","Math","floor","Date","payload","jti","isNumber","header","cty","typ","twr","sign","issuer","subject","expiresIn","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar jwt = require('jsonwebtoken');\nvar util = require('util');\n\n\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.workspaceSid - The workspace unique ID\n * @param {string} options.workerSid - The worker unique ID\n * @param {string} options.role - The role of the grant\n */\nfunction TaskRouterGrant(options) {\n  options = options || {};\n  this.workspaceSid = options.workspaceSid;\n  this.workerSid = options.workerSid;\n  this.role = options.role;\n}\n\n_.extend(TaskRouterGrant.prototype, {\n  key: 'task_router',\n\n  toPayload: function() {\n    var grant = {};\n    if (this.workspaceSid) { grant.workspace_sid = this.workspaceSid; }\n    if (this.workerSid) { grant.worker_sid = this.workerSid; }\n    if (this.role) { grant.role = this.role; }\n    return grant;\n  }\n});\n\n\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.serviceSid - The service unique ID\n * @param {string} options.endpointId - The endpoint ID\n * @param {string} options.deploymentRoleSid - SID of the deployment role to be\n *                 assigned to the user\n * @param {string} options.pushCredentialSid - The Push Credentials SID\n */\nfunction ChatGrant(options) {\n  options = options || {};\n  this.serviceSid = options.serviceSid;\n  this.endpointId = options.endpointId;\n  this.deploymentRoleSid = options.deploymentRoleSid;\n  this.pushCredentialSid = options.pushCredentialSid;\n}\n\n_.extend(ChatGrant.prototype, {\n  key: 'chat',\n\n  toPayload: function() {\n    var grant = {};\n    if (this.serviceSid) { grant.service_sid = this.serviceSid; }\n    if (this.endpointId) { grant.endpoint_id = this.endpointId; }\n    if (this.deploymentRoleSid) {\n      grant.deployment_role_sid = this.deploymentRoleSid;\n    }\n    if (this.pushCredentialSid) {\n      grant.push_credential_sid = this.pushCredentialSid;\n    }\n    return grant;\n  }\n});\n\n/**\n * @deprecated - Use ChatGrant instead.\n *\n * @constructor\n * @param {object} options - ...\n * @param {string} options.serviceSid - The service unique ID\n * @param {string} options.endpointId - The endpoint ID\n * @param {string} options.deploymentRoleSid - SID of the deployment role to be\n *                 assigned to the user\n * @param {string} options.pushCredentialSid - The Push Credentials SID\n */\nfunction IpMessagingGrant(options) {\n  ChatGrant.call(this, options);\n}\n\nIpMessagingGrant.prototype = _.create(ChatGrant.prototype, _.assign({\n  '_super': ChatGrant.prototype,\n  'constructor': ChatGrant\n}));\n\nIpMessagingGrant.prototype.key = 'ip_messaging';\n\n/**\n  * @deprecated - Use VideoGrant instead\n  *\n  * @constructor\n  * @param {object} options - ...\n  * @param {string} options.configurationProfileSid - The configuration\n  *                 profile unique ID\n  */\nfunction ConversationsGrant(options) {\n  options = options || {};\n  this.configurationProfileSid = options.configurationProfileSid;\n}\n\n_.extend(ConversationsGrant.prototype, {\n  key: 'rtc',\n  toPayload: function() {\n    var grant = {};\n    if (this.configurationProfileSid) {\n      grant.configuration_profile_sid = this.configurationProfileSid;\n    }\n    return grant;\n  }\n});\n\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.room - The Room name or Room sid.\n */\nfunction VideoGrant(options) {\n  options = options || {};\n  this.room = options.room;\n}\n\n_.extend(VideoGrant.prototype, {\n  key: 'video',\n  toPayload: function() {\n    var grant = {};\n    if (this.room) { grant.room = this.room; }\n    return grant;\n  }\n});\n\n/**\n * @constructor\n * @param {string} options.serviceSid - The service unique ID\n * @param {string} options.endpointId - The endpoint ID\n */\nfunction SyncGrant(options) {\n  options = options || {};\n  this.serviceSid = options.serviceSid;\n  this.endpointId = options.endpointId;\n}\n\n_.extend(SyncGrant.prototype, {\n  key: 'data_sync',\n\n  toPayload: function() {\n    var grant = {};\n    if (this.serviceSid) { grant.service_sid = this.serviceSid; }\n    if (this.endpointId) { grant.endpoint_id = this.endpointId; }\n    return grant;\n  }\n});\n\n/**\n * @constructor\n * @param {object} options - ...\n * @param {boolean} options.incomingAllow - Whether or not this endpoint is allowed to receive incoming calls as grants.identity\n * @param {string} options.outgoingApplicationSid - application sid to call when placing outgoing call\n * @param {object} options.outgoingApplicationParams - request params to pass to the application\n * @param {string} options.pushCredentialSid - Push Credential Sid to use when registering to receive incoming call notifications\n * @param {string} options.endpointId - Specify an endpoint identifier for this device, which will allow the developer\n *                 to direct calls to a specific endpoint when multiple devices are associated with a single identity\n */\nfunction VoiceGrant(options) {\n  options = options || {};\n  this.incomingAllow = options.incomingAllow;\n  this.outgoingApplicationSid = options.outgoingApplicationSid;\n  this.outgoingApplicationParams = options.outgoingApplicationParams;\n  this.pushCredentialSid = options.pushCredentialSid;\n  this.endpointId = options.endpointId;\n}\n\n_.extend(VoiceGrant.prototype, {\n  key: 'voice',\n  toPayload: function() {\n    var grant = {};\n    if (this.incomingAllow === true) {\n      grant.incoming = { allow: true };\n    }\n\n    if (this.outgoingApplicationSid) {\n      grant.outgoing = {};\n      grant.outgoing.application_sid = this.outgoingApplicationSid;\n\n      if (this.outgoingApplicationParams) {\n        grant.outgoing.params = this.outgoingApplicationParams;\n      }\n    }\n\n    if (this.pushCredentialSid) {\n      grant.push_credential_sid = this.pushCredentialSid;\n    }\n    if (this.endpointId) {\n      grant.endpoint_id = this.endpointId;\n    }\n    return grant;\n  }\n});\n\n/**\n * @constructor\n * @param {string} accountSid - The account's unique ID to which access is scoped\n * @param {string} keySid - The signing key's unique ID\n * @param {string} secret - The secret to sign the token with\n * @param {object} options - ...\n * @param {number} [options.ttl=3600] - Time to live in seconds\n * @param {string} [options.identity] - The identity of the first person\n * @param {number} [options.nbf] - Time from epoch in seconds for not before value\n * @param {string} [options.region] - The region value associated with this account\n */\nfunction AccessToken(accountSid, keySid, secret, options) {\n  if (!accountSid) { throw new Error('accountSid is required'); }\n  if (!keySid) { throw new Error('keySid is required'); }\n  if (!secret) { throw new Error('secret is required'); }\n  options = options || {};\n\n  this.accountSid = accountSid;\n  this.keySid = keySid;\n  this.secret = secret;\n  this.ttl = options.ttl || 3600;\n  this.identity = options.identity;\n  this.nbf = options.nbf;\n  this.region = options.region;\n  this.grants = [];\n}\n\n// Class level properties\nAccessToken.IpMessagingGrant = util.deprecate(IpMessagingGrant, 'IpMessagingGrant is deprecated, use ChatGrant instead.');\nAccessToken.ChatGrant = ChatGrant;\nAccessToken.VoiceGrant = VoiceGrant;\nAccessToken.SyncGrant = SyncGrant;\nAccessToken.VideoGrant = VideoGrant;\nAccessToken.ConversationsGrant = util.deprecate(ConversationsGrant, 'ConversationsGrant is deprecated, use VideoGrant instead.');\nAccessToken.TaskRouterGrant = TaskRouterGrant;\nAccessToken.DEFAULT_ALGORITHM = 'HS256';\nAccessToken.ALGORITHMS = [\n  'HS256',\n  'HS384',\n  'HS512'\n];\n\n_.extend(AccessToken.prototype, {\n  addGrant: function(grant) {\n    this.grants.push(grant);\n  },\n\n  toJwt: function(algorithm) {\n    algorithm = algorithm || AccessToken.DEFAULT_ALGORITHM;\n    if (!_.includes(AccessToken.ALGORITHMS, algorithm)) {\n      throw new Error('Algorithm not supported. Allowed values are ' + AccessToken.ALGORITHMS.join(', '));\n    }\n\n    var grants = {};\n    if (_.isInteger(this.identity) || _.isString(this.identity)) { grants.identity = String(this.identity); }\n\n    _.each(this.grants, function(grant) {\n      grants[grant.key] = grant.toPayload();\n    });\n\n    var now = Math.floor(Date.now() / 1000);\n    var payload = {\n      jti: this.keySid + '-' + now,\n      grants: grants\n    };\n    if (_.isNumber(this.nbf)) { payload.nbf = this.nbf; }\n\n    var header = {\n      cty: 'twilio-fpa;v=1',\n      typ: 'JWT'\n    };\n\n    if (this.region && _.isString(this.region)) {\n      header.twr = this.region;\n    }\n\n    return jwt.sign(payload, this.secret, {\n      header: header,\n      algorithm: algorithm,\n      issuer: this.keySid,\n      subject: this.accountSid,\n      expiresIn: this.ttl\n    });\n  }\n});\n\n\nmodule.exports = AccessToken;\n"]},"metadata":{},"sourceType":"module"}