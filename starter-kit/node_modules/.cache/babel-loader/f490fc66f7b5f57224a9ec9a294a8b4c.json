{"ast":null,"code":"'use strict';\n/**\n * The {@link DocumentVisibilityMonitor} monitors the visibility state of the DOM\n * and executes the attached listeners in phase order when the DOM is visible.\n */\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar DocumentVisibilityMonitor = function () {\n  /**\n   * Constructor.\n   * @param {number} [nPhases=1] - the number of phases\n   */\n  function DocumentVisibilityMonitor() {\n    var _this = this;\n\n    var nPhases = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n\n    _classCallCheck(this, DocumentVisibilityMonitor);\n\n    Object.defineProperties(this, {\n      _listeners: {\n        value: []\n      },\n      _onVisibilityChange: {\n        value: function value() {\n          if (document.visibilityState === 'visible') {\n            _this._emitVisible();\n          }\n        }\n      }\n    });\n\n    for (var i = 0; i < nPhases; i++) {\n      this._listeners.push([]);\n    }\n  }\n\n  _createClass(DocumentVisibilityMonitor, [{\n    key: '_listenerCount',\n    value: function _listenerCount() {\n      return this._listeners.reduce(function (count, phaseListeners) {\n        return count + phaseListeners.length;\n      }, 0);\n    }\n    /**\n     * Call all the listeners. Makes sure that all listeners for a given phase\n     * are executed before calling the listeners of the next phase.\n     * @private\n     */\n\n  }, {\n    key: '_emitVisible',\n    value: function _emitVisible() {\n      var _this2 = this;\n\n      var promise = Promise.resolve();\n\n      var _loop = function _loop(phase) {\n        promise = promise.then(function () {\n          return _this2._emitVisiblePhase(phase);\n        });\n      };\n\n      for (var phase = 1; phase <= this._listeners.length; phase++) {\n        _loop(phase);\n      }\n\n      return promise;\n    }\n    /**\n     * Call all the listeners for a given phase.\n     * @private\n     */\n\n  }, {\n    key: '_emitVisiblePhase',\n    value: function _emitVisiblePhase(phase) {\n      var phaseListeners = this._listeners[phase - 1];\n      return Promise.all(phaseListeners.map(function (listener) {\n        var ret = listener();\n        return ret instanceof Promise ? ret : Promise.resolve(ret);\n      }));\n    }\n    /**\n     * Start listening to the DOM visibility state change.\n     * @private\n     */\n\n  }, {\n    key: '_start',\n    value: function _start() {\n      document.addEventListener('visibilitychange', this._onVisibilityChange);\n    }\n    /**\n     * Stop listening to the DOM visibility state change.\n     * @private\n     */\n\n  }, {\n    key: '_stop',\n    value: function _stop() {\n      document.removeEventListener('visibilitychange', this._onVisibilityChange);\n    }\n    /**\n     * Listen for the DOM to be visible at the given phase.\n     * @param {number} phase\n     * @param {function} listener\n     * @returns {this}\n     */\n\n  }, {\n    key: 'onVisible',\n    value: function onVisible(phase, listener) {\n      if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n        throw new Error('invalid phase: ', phase);\n      }\n\n      var phaseListeners = this._listeners[phase - 1];\n      phaseListeners.push(listener);\n\n      if (this._listenerCount() === 1) {\n        this._start();\n      }\n\n      return this;\n    }\n    /**\n     * Stop listening for the DOM to be visible at the given phase.\n     * @param {number} phase\n     * @param {function} listener\n     * @returns {this}\n     */\n\n  }, {\n    key: 'offVisible',\n    value: function offVisible(phase, listener) {\n      if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n        throw new Error('invalid phase: ', phase);\n      }\n\n      var phaseListeners = this._listeners[phase - 1];\n      var index = phaseListeners.indexOf(listener);\n\n      if (index !== -1) {\n        phaseListeners.splice(index, 1);\n\n        if (this._listenerCount() === 0) {\n          this._stop();\n        }\n      }\n\n      return this;\n    }\n  }]);\n\n  return DocumentVisibilityMonitor;\n}();\n\nmodule.exports = new DocumentVisibilityMonitor(2);","map":{"version":3,"sources":["/Users/tony_niu/Visual Studio/Twilio/twilio-video-starter-kit/node_modules/twilio-video/es5/util/documentvisibilitymonitor.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","DocumentVisibilityMonitor","_this","nPhases","arguments","undefined","_listeners","value","_onVisibilityChange","document","visibilityState","_emitVisible","push","_listenerCount","reduce","count","phaseListeners","_this2","promise","Promise","resolve","_loop","phase","then","_emitVisiblePhase","all","map","listener","ret","_start","addEventListener","_stop","removeEventListener","onVisible","Error","offVisible","index","indexOf","splice","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\n/**\n * The {@link DocumentVisibilityMonitor} monitors the visibility state of the DOM\n * and executes the attached listeners in phase order when the DOM is visible.\n */\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DocumentVisibilityMonitor = function () {\n  /**\n   * Constructor.\n   * @param {number} [nPhases=1] - the number of phases\n   */\n  function DocumentVisibilityMonitor() {\n    var _this = this;\n\n    var nPhases = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n\n    _classCallCheck(this, DocumentVisibilityMonitor);\n\n    Object.defineProperties(this, {\n      _listeners: {\n        value: []\n      },\n      _onVisibilityChange: {\n        value: function value() {\n          if (document.visibilityState === 'visible') {\n            _this._emitVisible();\n          }\n        }\n      }\n    });\n\n    for (var i = 0; i < nPhases; i++) {\n      this._listeners.push([]);\n    }\n  }\n\n  _createClass(DocumentVisibilityMonitor, [{\n    key: '_listenerCount',\n    value: function _listenerCount() {\n      return this._listeners.reduce(function (count, phaseListeners) {\n        return count + phaseListeners.length;\n      }, 0);\n    }\n\n    /**\n     * Call all the listeners. Makes sure that all listeners for a given phase\n     * are executed before calling the listeners of the next phase.\n     * @private\n     */\n\n  }, {\n    key: '_emitVisible',\n    value: function _emitVisible() {\n      var _this2 = this;\n\n      var promise = Promise.resolve();\n\n      var _loop = function _loop(phase) {\n        promise = promise.then(function () {\n          return _this2._emitVisiblePhase(phase);\n        });\n      };\n\n      for (var phase = 1; phase <= this._listeners.length; phase++) {\n        _loop(phase);\n      }\n      return promise;\n    }\n\n    /**\n     * Call all the listeners for a given phase.\n     * @private\n     */\n\n  }, {\n    key: '_emitVisiblePhase',\n    value: function _emitVisiblePhase(phase) {\n      var phaseListeners = this._listeners[phase - 1];\n      return Promise.all(phaseListeners.map(function (listener) {\n        var ret = listener();\n        return ret instanceof Promise ? ret : Promise.resolve(ret);\n      }));\n    }\n\n    /**\n     * Start listening to the DOM visibility state change.\n     * @private\n     */\n\n  }, {\n    key: '_start',\n    value: function _start() {\n      document.addEventListener('visibilitychange', this._onVisibilityChange);\n    }\n\n    /**\n     * Stop listening to the DOM visibility state change.\n     * @private\n     */\n\n  }, {\n    key: '_stop',\n    value: function _stop() {\n      document.removeEventListener('visibilitychange', this._onVisibilityChange);\n    }\n\n    /**\n     * Listen for the DOM to be visible at the given phase.\n     * @param {number} phase\n     * @param {function} listener\n     * @returns {this}\n     */\n\n  }, {\n    key: 'onVisible',\n    value: function onVisible(phase, listener) {\n      if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n        throw new Error('invalid phase: ', phase);\n      }\n      var phaseListeners = this._listeners[phase - 1];\n      phaseListeners.push(listener);\n      if (this._listenerCount() === 1) {\n        this._start();\n      }\n      return this;\n    }\n\n    /**\n     * Stop listening for the DOM to be visible at the given phase.\n     * @param {number} phase\n     * @param {function} listener\n     * @returns {this}\n     */\n\n  }, {\n    key: 'offVisible',\n    value: function offVisible(phase, listener) {\n      if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n        throw new Error('invalid phase: ', phase);\n      }\n\n      var phaseListeners = this._listeners[phase - 1];\n      var index = phaseListeners.indexOf(listener);\n      if (index !== -1) {\n        phaseListeners.splice(index, 1);\n        if (this._listenerCount() === 0) {\n          this._stop();\n        }\n      }\n      return this;\n    }\n  }]);\n\n  return DocumentVisibilityMonitor;\n}();\n\nmodule.exports = new DocumentVisibilityMonitor(2);"]},"metadata":{},"sourceType":"script"}