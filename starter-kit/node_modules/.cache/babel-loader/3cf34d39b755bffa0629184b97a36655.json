{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar jwt = require('jsonwebtoken');\n\nvar qs = require('querystring');\n/**\n * @constructor\n * @param filters\n */\n\n\nfunction EventStreamScope(filters) {\n  this.filters = filters || {};\n}\n\n_c = EventStreamScope;\n\n_.extend(EventStreamScope.prototype, {\n  scope: 'scope:stream:subscribe',\n  payload: function () {\n    var queryArgs = ['path=/2010-04-01/Events'];\n\n    if (!_.isEmpty(this.filters)) {\n      var queryParams = _.map(this.filters, function (value, key) {\n        return _.join([qs.escape(key), qs.escape(value)], '=');\n      });\n\n      var filterParams = _.join(queryParams, '&');\n\n      queryArgs.push(_.join(['appParams', qs.escape(filterParams)], '='));\n    }\n\n    var queryString = _.join(queryArgs, '&');\n\n    return _.join([this.scope, queryString], '?');\n  }\n});\n/**\n * @constructor\n * @param clientName\n */\n\n\nfunction IncomingClientScope(clientName) {\n  this.clientName = clientName;\n}\n\n_c2 = IncomingClientScope;\n\n_.extend(IncomingClientScope.prototype, {\n  scope: 'scope:client:incoming',\n  payload: function () {\n    var query = _.join(['clientName', qs.escape(this.clientName)], '=');\n\n    return _.join([this.scope, query], '?');\n  }\n});\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.applicationSid - the application sid\n * @param {string} [options.clientName] - the client name\n * @param {object} [options.params] - parameters\n */\n\n\nfunction OutgoingClientScope(options) {\n  if (_.isUndefined(options)) {\n    throw new Error('Required parameter \"options\" missing.');\n  }\n\n  if (_.isUndefined(options.applicationSid)) {\n    throw new Error('Required parameter \"options.applicationSid\" missing.');\n  }\n\n  options = options || {};\n  this.applicationSid = options.applicationSid;\n  this.clientName = options.clientName;\n  this.params = options.params;\n}\n\n_c3 = OutgoingClientScope;\n\n_.extend(OutgoingClientScope.prototype, {\n  scope: 'scope:client:outgoing',\n  payload: function () {\n    var queryArgs = [_.join(['appSid', qs.escape(this.applicationSid)], '=')];\n\n    if (_.isString(this.clientName)) {\n      queryArgs.push(_.join(['clientName', qs.escape(this.clientName)], '='));\n    }\n\n    if (_.isObject(this.params)) {\n      var queryParams = _.map(this.params, function (value, key) {\n        return _.join([qs.escape(key), qs.escape(value)], '=');\n      });\n\n      var filterParams = _.join(queryParams, '&');\n\n      queryArgs.push(_.join(['appParams', qs.escape(filterParams)], '='));\n    }\n\n    var queryString = _.join(queryArgs, '&');\n\n    return _.join([this.scope, queryString], '?');\n  }\n});\n/**\n * @constructor\n * @param options\n */\n\n\nfunction ClientCapability(options) {\n  if (_.isUndefined(options)) {\n    throw new Error('Required parameter \"options\" missing.');\n  }\n\n  if (_.isUndefined(options.accountSid)) {\n    throw new Error('Required parameter \"options.accountSid\" missing.');\n  }\n\n  if (_.isUndefined(options.authToken)) {\n    throw new Error('Required parameter \"options.authToken\" missing.');\n  }\n\n  options = options || {};\n  this.accountSid = options.accountSid;\n  this.authToken = options.authToken;\n  this.ttl = options.ttl || 3600;\n  this.scopes = [];\n}\n\n_c4 = ClientCapability;\nClientCapability.EventStreamScope = EventStreamScope;\nClientCapability.IncomingClientScope = IncomingClientScope;\nClientCapability.OutgoingClientScope = OutgoingClientScope;\n\n_.extend(ClientCapability.prototype, {\n  addScope: function (scope) {\n    this.scopes.push(scope);\n  },\n  toJwt: function () {\n    var payload = {\n      scope: _.join(_.map(this.scopes, function (scope) {\n        return scope.payload();\n      }), ' '),\n      iss: this.accountSid,\n      exp: Math.floor(new Date() / 1000) + this.ttl\n    };\n    return jwt.sign(payload, this.authToken);\n  }\n});\n\nmodule.exports = ClientCapability;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"EventStreamScope\");\n$RefreshReg$(_c2, \"IncomingClientScope\");\n$RefreshReg$(_c3, \"OutgoingClientScope\");\n$RefreshReg$(_c4, \"ClientCapability\");","map":{"version":3,"sources":["/Users/tony_niu/Visual Studio/Twilio/twilio-video-starter-kit/src/token-service/node_modules/twilio/lib/jwt/ClientCapability.js"],"names":["_","require","jwt","qs","EventStreamScope","filters","extend","prototype","scope","payload","queryArgs","isEmpty","queryParams","map","value","key","join","escape","filterParams","push","queryString","IncomingClientScope","clientName","query","OutgoingClientScope","options","isUndefined","Error","applicationSid","params","isString","isObject","ClientCapability","accountSid","authToken","ttl","scopes","addScope","toJwt","iss","exp","Math","floor","Date","sign","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar jwt = require('jsonwebtoken');\nvar qs = require('querystring');\n\n/**\n * @constructor\n * @param filters\n */\nfunction EventStreamScope(filters) {\n  this.filters = filters || {};\n}\n\n_.extend(EventStreamScope.prototype, {\n  scope: 'scope:stream:subscribe',\n\n  payload: function() {\n    var queryArgs = ['path=/2010-04-01/Events'];\n\n    if (!_.isEmpty(this.filters)) {\n      var queryParams = _.map(this.filters, function(value, key) {\n        return _.join([qs.escape(key), qs.escape(value)], '=');\n      });\n      var filterParams = _.join(queryParams, '&');\n\n      queryArgs.push(_.join(['appParams', qs.escape(filterParams)], '='));\n    }\n\n    var queryString = _.join(queryArgs, '&');\n    return _.join([this.scope, queryString], '?');\n  }\n});\n\n/**\n * @constructor\n * @param clientName\n */\nfunction IncomingClientScope(clientName) {\n  this.clientName = clientName;\n}\n\n_.extend(IncomingClientScope.prototype, {\n  scope: 'scope:client:incoming',\n\n  payload: function() {\n    var query = _.join(['clientName', qs.escape(this.clientName)], '=');\n    return _.join([this.scope, query], '?');\n  }\n});\n\n/**\n * @constructor\n * @param {object} options - ...\n * @param {string} options.applicationSid - the application sid\n * @param {string} [options.clientName] - the client name\n * @param {object} [options.params] - parameters\n */\nfunction OutgoingClientScope(options) {\n  if (_.isUndefined(options)) {\n    throw new Error('Required parameter \"options\" missing.');\n  }\n  if (_.isUndefined(options.applicationSid)) {\n    throw new Error('Required parameter \"options.applicationSid\" missing.');\n  }\n\n  options = options || {};\n  this.applicationSid = options.applicationSid;\n  this.clientName = options.clientName;\n  this.params = options.params;\n}\n\n_.extend(OutgoingClientScope.prototype, {\n  scope: 'scope:client:outgoing',\n\n  payload: function() {\n    var queryArgs = [_.join(['appSid', qs.escape(this.applicationSid)], '=')];\n\n    if (_.isString(this.clientName)) {\n      queryArgs.push(_.join(['clientName', qs.escape(this.clientName)], '='));\n    }\n\n    if (_.isObject(this.params)) {\n      var queryParams = _.map(this.params, function(value, key) {\n        return _.join([qs.escape(key), qs.escape(value)], '=');\n      });\n      var filterParams = _.join(queryParams, '&');\n\n      queryArgs.push(_.join(['appParams', qs.escape(filterParams)], '='));\n    }\n\n    var queryString = _.join(queryArgs, '&');\n    return _.join([this.scope, queryString], '?');\n  }\n});\n\n/**\n * @constructor\n * @param options\n */\nfunction ClientCapability(options) {\n  if (_.isUndefined(options)) {\n    throw new Error('Required parameter \"options\" missing.');\n  }\n  if (_.isUndefined(options.accountSid)) {\n    throw new Error('Required parameter \"options.accountSid\" missing.');\n  }\n  if (_.isUndefined(options.authToken)) {\n    throw new Error('Required parameter \"options.authToken\" missing.');\n  }\n\n  options = options || {};\n  this.accountSid = options.accountSid;\n  this.authToken = options.authToken;\n  this.ttl = options.ttl || 3600;\n  this.scopes = [];\n}\n\nClientCapability.EventStreamScope = EventStreamScope;\nClientCapability.IncomingClientScope = IncomingClientScope;\nClientCapability.OutgoingClientScope = OutgoingClientScope;\n\n_.extend(ClientCapability.prototype, {\n  addScope: function(scope) {\n    this.scopes.push(scope);\n  },\n\n  toJwt: function() {\n    var payload = {\n      scope: _.join(_.map(this.scopes, function(scope) {\n        return scope.payload();\n      }), ' '),\n      iss: this.accountSid,\n      exp: Math.floor(new Date() / 1000) + this.ttl\n    };\n\n    return jwt.sign(payload, this.authToken);\n  }\n});\n\nmodule.exports = ClientCapability;\n"]},"metadata":{},"sourceType":"module"}